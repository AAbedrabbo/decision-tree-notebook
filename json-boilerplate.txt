#    CONVERT RULES TO JSON FORMAT

def rules(clf, features, labels, node_index=0):

    node = {}
    if clf.tree_.children_left[node_index] == -1:  # indicates leaf
        count_labels = zip(clf.tree_.value[node_index, 0], labels)
        percent_chance = count_labels[1][0]/(count_labels[1][0]+count_labels[0][0])*100
        n = int(count_labels[0][0] + count_labels[1][0])
        node['name'] = '{}% chance of leaving, n = {}'.format(round(percent_chance,2), n)
    else:
        feature = features[clf.tree_.feature[node_index]]
        threshold = clf.tree_.threshold[node_index]
        node['name'] = '{} > {}'.format(feature, round(threshold, 2))
        left_index = clf.tree_.children_left[node_index]
        right_index = clf.tree_.children_right[node_index]
        node['children'] = [rules(clf, features, labels, right_index),
                            rules(clf, features, labels, left_index)]
    return node

#    GET DATA COLUMN TITLES

hrnames = np.genfromtxt('HR_data.csv', delimiter=",", skip_header = 0, dtype = str)[0]
hrnames = hrnames.tolist()
hrnames_feature = hrnames[1:0]
hrnames_target = hrnames[1]

#    SAVE FORMATTED RULES AS JSON FILE

import json

r = rules(clf, hrnames_feature, hrnames_target)
with open('rules.json', 'w') as f:
    f.write(json.dumps(r))